/ k 2016.08.09
input:289326
p:(1 0;0 1;-1 0;0 -1)
w:(,0 0),+\p@4!&1+&600#2
{+/x|-x}@w@input-1
n:{x+/:(1 0;1 1;0 1;-1 1;-1 0;-1 -1;0 -1;1 -1)}
d:w!1,1_(#w)#0N
e:{input>d@w@x-1}{q:w x;d[q]:+/d@n q;x+1}/1
d@w@e-1
\\
